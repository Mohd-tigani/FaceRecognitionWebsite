
# Logging in the website using Face recognition

### link: https://youtu.be/UqxrJvn_-rw

### Description:

This code is a Flask application that implements a web-based user authentication system with face recognition using a webcam. Below is a breakdown of the code:

Importing Required Libraries: The code starts by importing various libraries and modules required for the application, including cv2 (OpenCV for image processing), base64, face_recognition, PIL (Python Imaging Library), io, and Flask-related modules.

Flask Application Setup: The Flask application is created with Flask(__name__). It also configures some settings like auto-reloading templates, session management, and MySQL database connection.

Webcam Initialization: The code initializes the webcam by creating a global variable camera1 and assigning it the video capture object from OpenCV (cv2.VideoCapture(0)).

Face Cascade Classifier: A cascade classifier object is created using the XML file haarcascade_frontalface_default.xml. This classifier is used for face detection in video frames.

Camera0 Function: This function is responsible for capturing video frames from the webcam, performing face detection, drawing rectangles around detected faces, and streaming the processed frames as a video feed. It uses a generator function to continuously yield frames.

/webcam Route: This route is mapped to the camera0 function and returns a Flask Response object that streams the video feed generated by camera0 as multipart JPEG data.

/ Route: The root route returns the index.html template.

/camera Route: This route renders the camera.html template.

/recognition Route: This route renders the recognition.html template.

/identification Route: This route is responsible for face recognition. When accessed via a POST request, it captures an image from the webcam, saves it, and performs face recognition by comparing it with a stored user image. If the faces match, the user is considered verified, and the session variable verified is set to True. Otherwise, the user is redirected to the login page with a "Not verified" message.

/take_photo Route: This route handles taking a photo using the webcam. When accessed via a POST request, it captures an image from the webcam and saves it as taken_photo.jpg.

/login Route: This route handles user login. It checks if the username and password provided in the login form match the records in the MySQL database. If the login is successful, the user ID is stored in the session, and the user is redirected to the recognition page. If the login fails, an appropriate error message is displayed.

/logout Route: This route clears the session and redirects the user to the root page ("/").

/register Route: This route handles user registration. When accessed via a POST request, it validates the username and password, generates a random user ID, and inserts the user's information into the MySQL database. If the registration is successful, the user is redirected to the camera page.

Main Execution: Finally, the Flask application is run with app.run(debug=True).

It's worth noting that this code assumes the availability of a MySQL database and the required database tables (profiles and photos). It also assumes the presence of the XML file haarcascade_frontalface_default.xml for face detection.

### the required modules and setup

Importing Required Libraries:
import cv2
import random
import os
import base64
import face_recognition
from PIL import Image
import io 
from flask import Flask, flash, redirect, Response, render_template, request, session
from flask_mysqldb import MySQL
from flask_session import Session

The code begins by importing the necessary libraries and modules. cv2 is OpenCV, used for image processing. random, os, base64, and face_recognition are used for various functionalities. Image from PIL (Python Imaging Library) is used for image manipulation. io is used for I/O operations. The remaining imports are Flask-related modules used for creating the web application.

Flask Application Setup:
```
app = Flask(__name__)
app.config["TEMPLATES_AUTO_RELOAD"] = True
app.config['MYSQL_HOST'] = "localhost"
app.config['MYSQL_USER'] = "root"
app.config['MYSQL_PASSWORD'] = ""
app.config['MYSQL_DB'] = "users"
app.config['MYSQL_PORT'] = 4306
mysql = MySQL(app)
app.config["SESSION_PERMANENT"] = False
app.config["SESSION_TYPE"] = "filesystem"
Session(app)
The Flask application is created with Flask(__name__). The TEMPLATES_AUTO_RELOAD configuration ensures that templates are automatically reloaded on every request. The MySQL database connection is configured with the appropriate host, user, password, database, and port settings. The SESSION_PERMANENT and SESSION_TYPE configurations are set to manage user sessions.
```

Webcam Initialization:

camera1 = cv2.VideoCapture(0)
The webcam is initialized by creating a global variable camera1 and assigning it the video capture object from OpenCV (cv2.VideoCapture(0)).

Face Cascade Classifier:

face_cascade = cv2.CascadeClassifier('haarcascade_frontalface_default.xml')
A cascade classifier object is created using the XML file haarcascade_frontalface_default.xml. This classifier is used for face detection in video frames.


Camera0 Function:
```
def camera0():
    camera1 = cv2.VideoCapture(0)
    while True:
        success, frame = camera1.read()
        frame = cv2.flip(frame, 1)
        if not success:
            break
        else:
            gray = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)
            faces = face_cascade.detectMultiScale(gray, 1.3, 4)
            for (x, y, w, h) in faces:
                cv2.rectangle(frame, (x, y), (x + w, y + h), (0, 0, 255), 2)
            ret, buffer = cv2.imencode('.jpg', frame)
            frame = buffer.tobytes()
            yield (b'--frame\r\n'
                    b'Content-Type: image/jpeg\r\n\r\n' + frame + b'\r\n')
```
The camera0 function is responsible for capturing video frames from the webcam. It continuously reads frames from the webcam using camera1.read(). The frames are flipped horizontally using cv2.flip(frame, 1) to make the video behave like a mirror. The frames are converted to grayscale (cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)), and the face_cascade classifier is used to detect faces in the grayscale frames (face_cascade.detectMultiScale(gray, 1.3, 4)). Detected faces are marked

### folders
Project contains the following folders:

**.vscode**: modifying or using default setting on visual studio

**static**: Designing the web app using javascript

**templates**: templates folder has 6 htmls files: camera,index,layout,login,recognition and register.

**app.py**: Where the required python packages are used to implement the flask app.

**requirements.txt**: list of required Python packages and additional information needed for this project to work

**user.sql**: User database that contains 2 tables used for this project

### face_recognition
This line of code shown below 

source: https://pypi.org/project/face-recognition/#description

Allows the user to compare between an known image and an unknown image. If both are equal result shall yield it to be True otherwise its will be false.
the result is generate in the code shown below:
```
import face_recognition

known_image = face_recognition.load_image_file("user.jpg")
unknown_image = face_recognition.load_image_file("logged_user.jpg")

known_encoding = face_recognition.face_encodings(known_image)[0]
unknown_encoding = face_recognition.face_encodings(unknown_image)[0]

results = face_recognition.compare_faces([Known_encoding], unknown_encoding)
```
visit the source link for more information.

### xampp
Source: https://www.apachefriends.org/download.html

downloading xampp is needed for this project to work so it can connect to the mysql server in order to use its database.

Note: you may require to change ports since the default port 3306 doesnt usually work all the time.














